{% extends "base.html" %}
{% block content %}
<h2>Tableau de bord</h2>

<section class="grid cols-3">

  <!-- Joueurs -->
  <div class="card">
    <h3>Joueurs inscrits ({{ players|length }})</h3>
    <ul style="margin:8px 0 0 0;padding:0;list-style:none">
      {% for p in players %}
        <li style="padding:6px 0;border-bottom:1px solid var(--line)">
          {{ p.name }}
          {% if p.commander %} — {{ p.commander }}{% endif %}
          {% if current_user.is_authenticated and current_user.is_admin and p.email %} — {{ p.email }}{% endif %}
        </li>
      {% else %}
        <li class="muted">Aucun joueur inscrit.</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Leaderboard -->
  <div class="card">
    <h3>Leaderboard</h3>
    <ol style="margin:8px 0 0 18px">
      {% for row, user in leaderboard %}
        <li>{{ user.name }} — <strong>{{ row.points }} pts</strong></li>
      {% else %}
        <li class="muted">Aucun point enregistré.</li>
      {% endfor %}
    </ol>
  </div>

  <!-- Mes tables -->
  <div class="card">
    <h3>Mes tables</h3>
    <ul style="margin:8px 0 0 0;padding:0;list-style:none">
      {% for m in matches %}
        <li style="padding:6px 0;border-bottom:1px solid var(--line)">
          <a class="btn secondary" href="{{ url_for('match_detail', match_id=m.id) }}">
            Ronde {{ m.round_number }} — Table {{ m.id }}
          </a>
        </li>
      {% else %}
        <li class="muted">Vous n'êtes assigné à aucune table.</li>
      {% endfor %}
    </ul>
  </div>

  {% if current_user.is_authenticated and current_user.is_admin %}
  <!-- Bloc Admin -->
  <div class="card" style="grid-column:1/-1">
    <h3>Admin — Contrôles tournoi</h3>

    {% if tournaments is defined and tournaments %}
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Tournoi</th>
              <th>Statut</th>
              <th style="width:1%;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for t in tournaments %}
            <tr>
              <td>
                <a href="{{ url_for('tournament_detail', tournament_id=t.id) }}">{{ t.name }}</a>
              </td>
              <td>
                {% if t.started %}
                  <span class="tag">En cours</span>
                {% else %}
                  <span class="tag ghost">Pas commencé</span>
                {% endif %}
              </td>
              <td>
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                  {% if not t.started %}
                    <form method="post" action="{{ url_for('admin_tournament_start', tournament_id=t.id) }}">
                      <button class="btn">Démarrer</button>
                    </form>
                  {% else %}
                    <form method="post" action="{{ url_for('admin_tournament_round_next', tournament_id=t.id) }}">
                      <button class="btn">Prochaine ronde</button>
                    </form>
                  {% endif %}
                  <a class="btn ghost" href="{{ url_for('tournament_detail', tournament_id=t.id) }}">Détails</a>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="muted" style="margin-bottom:12px;">
        Aucun tournoi fourni au template. Utilise le panneau Admin pour gérer les rondes.
      </p>
      <a class="btn" href="{{ url_for('admin_home') }}">Aller au panneau Admin</a>
    {% endif %}
  </div>
  {% endif %}

</section>
{% endblock %}
